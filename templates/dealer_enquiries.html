{% extends 'base.html' %}
{% block content %}

<div class="container mt-5">
    <h3 class="mb-4">Customer Enquiries</h3>

    {% for e in enquiries %}
    <div class="card mb-4 p-4 shadow-sm">

  <h5>{{ e.car.title }}</h5>

  <p><strong>Name:</strong> {{ e.name }}</p>
  <p><strong>Email:</strong> {{ e.email }}</p>
  <p><strong>Phone:</strong> {{ e.phone }}</p>
  <p>{{ e.message }}</p>

  <!-- STATUS BADGE -->
  <span class="badge
    {% if e.status == 'new' %}bg-primary
    {% elif e.status == 'contacted' %}bg-warning
    {% else %}bg-success{% endif %}
  ">
    {{ e.status|title }}
  </span>

  <!-- ACTIONS -->
  <div class="d-flex gap-2 mt-3">

    <a href="mailto:{{ e.email }}?subject=Regarding {{ e.car.title }}"
       class="btn btn-sm btn-outline-primary">
      Email
    </a>

    <a href="tel:{{ e.phone }}"
       class="btn btn-sm btn-outline-success">
      Call
    </a>

    <!-- STATUS UPDATE FORM -->
    <form method="post"
          action="{% url 'update_enquiry_status' e.id %}">
      {% csrf_token %}
      <select name="status"
              class="form-select form-select-sm"
              onchange="this.form.submit()">

        <option value="new" {% if e.status == 'new' %}selected{% endif %}>
          New
        </option>
        <option value="contacted" {% if e.status == 'contacted' %}selected{% endif %}>
          Contacted
        </option>
        <option value="closed" {% if e.status == 'closed' %}selected{% endif %}>
          Closed
        </option>

      </select>
    </form>

  </div>

  <small class="text-muted d-block mt-2">
    {{ e.created_at }}
  </small>
<form method="post"
      action="{% url 'reply_enquiry' e.id %}"
      class="mt-3">
  {% csrf_token %}
  <textarea name="message"
            class="form-control mb-2"
            placeholder="Write reply to customer..."
            rows="2"></textarea>

  <button class="btn btn-sm btn-dark">
    Send Reply
  </button>
</form>

</div>

    {% empty %}
  <div class="text-center py-5">
    <h5>No enquiries yet</h5>
    <p class="text-muted">
      Once customers contact you, enquiries will appear here.
    </p>
  </div>
    {% endfor %}
</div>

{% endblock %}
